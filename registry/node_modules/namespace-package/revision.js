// Installed Modules
var restify = require('restify')

// Local Modules
var dalpkg = require('dal/package')
var logger = require('logger').child({component: 'namespace-package/revision'})

module.exports = function namespaceRevision (req, res, next) {
  if (typeof req.params.revision === 'undefined') {
    return next(new restify.MissingParameterError('revision is a required parameter'))
  }

  req.package.revision = req.params.revision

  logger.debug(req.package, 'package information')

  dalpkg.revisionUpdate(req.body, function (err) {
    if (err) {
      logger.fatal({err: err}, 'dalpkg.revisionUpdate error')
      return next(err)
    }

    logger.info('revision update successful')

    res.end()
    return next()
  })
}
