var util = require('util')
var url = require('url')
var pkgdal = require('dal/package')
var auth = require('auth')

var logger = require('logger').child({component: 'namespace-package/dist-tags/ls'})

module.exports = function namespaceDisttagsLs (req, res, next) {

  auth.verifyFromDatastore(req, res, 'write', function(err) {
    if (err) {
      // res.statusCode = 401
      // return res.end(JSON.stringify({error: 'unauthorized'}))
      return next(err)
    }

    pkgdal.get(req.package.id, function(err, pkgdata) {
      if (err) {
        //res.statusCode = 404
        //return res.end(JSON.stringify({error: err.message}))
        return next(err)
      }

      //res.end(JSON.stringify(pkgdata['dist-tags']))
      res.send(pkgdata['dist-tags'])
      return next()
    })
  })
}
